<div class="header">
  <div
    style="width:90%; height:80px; max-width:2000px; left:50%; transform:translate(-50%, 0); position:relative;"
  >
    <img
      src="/img/logo.png"
      style="top:50%; transform: translate(0, -50%); height: 60px; filter:invert(1); position:absolute;"
    />
    <input
      type="text"
      id="game-search"
      placeholder="ï€‚   Search for any Wii title..."
      style="font-family:inter, FontAwesome;"
    />
    <div id="suggestions"></div>
    <div>
      <div
        style="right:0; top:50%; transform:translate(0, -50%); display:flex; gap:18px; position:absolute;"
      >
        <a href="/" style="text-decoration: none; color:white;"
          ><div
            style="height:50px; background-color: #121212; display:flex; justify-content:center; align-items:center;"
          >
            <i class="fa fa-home" style="margin-right:5px;"></i> Home
          </div></a
        >
        <a href="/online" style="text-decoration: none; color:white;"
          ><div
            style="height:50px; background-color: #121212; display:flex; justify-content:center; align-items:center;"
          >
            <i class="fa fa-globe" style="margin-right:5px;"></i> Online
          </div></a
        >
        <a href="/settings" style="text-decoration: none; color:white;"
          ><div
            style="height:50px; background-color: #121212; display:flex; justify-content:center; align-items:center;"
          >
            <i class="fa fa-server" style="margin-right:5px;"></i> Status
          </div></a
        >
        <button type="button" class="btn btn-success"
          ><i
            class="fa-solid fa-square-arrow-up-right"
            style="margin-right:5px;"></i> Visit WiiLink</button
        >
      </div>
    </div>
  </div>

  <script is:inline>
    fetch("../../json/gamespy_titles.json")
      .then((response) => response.json())
      .then((gamespyTitles) => {
        fetch("../../json/pages.json")
          .then((response) => response.json())
          .then((games) => {
            var gameSearchInput = document.getElementById("game-search");
            var suggestionsDiv = document.getElementById("suggestions");

            gameSearchInput.addEventListener("focus", function (e) {
              suggestionsDiv.style.display = "block";
            });

            gameSearchInput.addEventListener("blur", function (e) {
              if (suggestionsDiv.contains(e.relatedTarget)) {
                return;
              }
              suggestionsDiv.style.display = "none";
            });

            gameSearchInput.addEventListener("input", function (e) {
              suggestionsDiv.innerHTML =
                '<p style="margin-left:20px; font-family:Gilroy; color:white;">Suggestions:</p>'; // clear previous suggestions
              var inputText = gameSearchInput.value.toLowerCase();
              var counter = 0;
              for (var i = 0; i < games.length; i++) {
                if (games[i].gameName.toLowerCase().startsWith(inputText)) {
                  const gameIdPrefix = games[i].gameId.substring(0, 3);
                  const isFound = gamespyTitles.some(
                    (gamespyTitle) => gamespyTitle.GameID === gameIdPrefix,
                  );
                  var onlineFeatures = "";
                  var suggestion = document.createElement("div");
                  if (isFound) {
                    onlineFeatures +=
                      '<i class="fa-solid fa-earth-americas" style=" padding:5px; padding-left:10px; padding-right:10px; background-color:#3c86c7; border-radius:4px; font-size:15px; margin-right:18px;"></i>';
                  }
                  suggestion.innerHTML =
                    '<a href="/online/' +
                    games[i].gameId +
                    '" id="suggestionitem" style="width:95%; height:100px; margin:10px; border-radius:8px; color:white; text-decoration:none; display:flex; align-items:center; justify-content:space-between; flex-direction:row; overflow:hidden; position:relative;"><img src="https://art.gametdb.com/wii/cover/US/' +
                    games[i].gameId +
                    '.png" onerror="this.onerror=null; this.src=\'https://art.gametdb.com/wii/cover/EN/' +
                    games[i].gameId +
                    '.png\'; this.onerror=function(){this.src=\'/img/disc_placeholder.png\';};" style="filter:blur(8px) opacity(0.1); position:absolute;" width="100%"> <img src="https://art.gametdb.com/wii/disc/US/' +
                    games[i].gameId +
                    '.png" onerror="this.onerror=null; this.src=\'https://art.gametdb.com/wii/disc/EN/' +
                    games[i].gameId +
                    '.png\'; this.onerror=function(){this.src=\'/img/disc_placeholder.png\';};" style="margin-left:20px; margin-right:15px;" width="70px"><div style="margin-right:20px; font-size:30px; line-height:30px; text-align:right;">' +
                    games[i].gameName +
                    "<br><i>" +
                    onlineFeatures +
                    '</i><i style="font-size:20px; opacity:0.7;">' +
                    games[i].gameId +
                    "</i></div></a>";
                  suggestionsDiv.appendChild(suggestion);
                  counter++;
                }
                if (counter >= 5) {
                  break;
                }
              }
            });
            gameSearchInput.addEventListener("keydown", function (e) {
              if (e.key === "Enter") {
                e.preventDefault();
                const firstSuggestion =
                  document.querySelector("#suggestionitem");
                if (firstSuggestion) {
                  window.location.href = firstSuggestion.getAttribute("href");
                }
              }
            });
          });
      });
  </script>

  <style>
    #suggestions {
      left: 110px;
      width: 600px;
      max-height: 300px;
      transform: translate(0, 10px);
      padding-top: 5px;
      background-color: rgb(23, 23, 23);
      border-radius: 8px;
      border-top-left-radius: 0px;
      border-top-right-radius: 0px;
      border: 2px solid #ffffff10;
      border-top: 0px;
      z-index: 10000;
      display: none;
      overflow-y: scroll;
      position: relative;
      transition: 0.3s;
    }

    #suggestions::before {
      content: "";
      position: sticky;
      top: 0;
      left: 0;
      right: 0;
      width: 100%;
      height: 40px;
      background: linear-gradient(
        to bottom,
        rgb(255, 255, 255),
        rgba(23, 23, 23, 0)
      );
      z-index: 10000;
      pointer-events: none;
    }

    textarea:focus,
    input:focus {
      outline: none;
    }

    .header {
      width: 100%;
      height: 80px;
      z-index: 10000;
      background-color: #121212;
      position: relative;
    }

    #game-search {
      left: 110px;
      top: 50%;
      transform: translate(0, -50%);
      width: 600px;
      height: 50px;
      padding: 10px;
      border-radius: 8px;
      color: white;
      border: 2px solid #ffffff10;
      background-color: rgb(23, 23, 23);
      position: relative;
    }
  </style>

  <style is:global>
    #suggestionitem {
      border: 2px solid #ffffff20;
      transition: 0.3s;
    }

    #suggestionitem:hover {
      transform: scale(1.01);
      border: 2px solid #ffffff80;
      transition: 0.3s;
    }
  </style>
</div>
